# Deploy Installer

Automated installer script for setting up [simple-php-git-deploy](https://github.com/markomarkovic/simple-php-git-deploy) on cPanel servers.

## Overview

This installer automates the entire setup process for deploying code from GitHub to your cPanel hosting environment. It handles:

- Server requirement checks
- Automatic file downloads
- SSH key generation
- Configuration file creation
- Webhook URL generation

## Installation

1. Download `installer.php`:
   - **Direct download**: [Right-click this link](https://raw.githubusercontent.com/Serviworldwide/deploy-installer/main/installer.php) and select "Save Link As" or "Save Target As"
   - **Or use curl/wget**: 
     ```bash
     curl -L https://raw.githubusercontent.com/Serviworldwide/deploy-installer/main/installer.php -o installer.php
     ```
2. Upload **only** `installer.php` to your cPanel account's `public_html` directory
3. Access the installer via your web browser: `http://yourdomain.com/installer.php`
4. Follow the step-by-step wizard

The installer will automatically download `deploy.php` and generate all necessary configuration files.

## Features

### Step 1: Requirements Check
- Verifies PHP functions (exec, shell_exec, file_get_contents)
- Checks for required binaries (git, rsync, ssh-keygen)
- Displays clear status indicators for each requirement

### Step 2: Download & Setup
- Automatically downloads `deploy.php` from Serviworldwide/deploy-installer repository
- Generates SSH key pair (ed25519) if needed
- Adds public key to authorized_keys
- Sets proper file permissions

### Step 3: Configuration
- Collects deployment configuration:
  - Secret access token (with auto-generate option)
  - GitHub repository URL (automatically converts to SSH format)
  - Branch name
  - Target directory path
- Generates complete `deploy-config.php` file with proper permissions (600)

### Step 4: Results
- Displays SSH public key with copy button
- Shows webhook URL with copy button
- Provides step-by-step instructions for GitHub setup
- Configuration summary

## Usage

1. **Run the installer**: Navigate to `installer.php` in your browser
2. **Check requirements**: Ensure all requirements are met
3. **Download files**: Let the installer download and set up files
4. **Configure**: Enter your repository details and secret token
5. **Copy information**: Use the copy buttons to easily add keys and URLs to GitHub
6. **Complete setup**: Follow the on-screen instructions to finish GitHub configuration

## Requirements

- PHP 7.0 or higher
- cPanel hosting environment
- `exec()` and `shell_exec()` functions enabled
- Git, rsync, and ssh-keygen binaries available
- Write permissions to `public_html` and `~/.ssh` directory

## Security Notes

- The `deploy-config.php` file is automatically set to permissions 600 (read/write for owner only)
- Secret access token should be kept secure
- Consider removing or protecting `installer.php` after setup is complete

## Troubleshooting

### Missing Requirements

If requirements are not met:
- **PHP functions disabled**: Enable in cPanel → MultiPHP Manager → PHP-FPM Settings → remove ban on exec_shell
- **Missing binaries**: Contact your hosting provider to install git, rsync, or ssh-keygen

### SSH Key Issues

If SSH key generation fails:
- Check that `~/.ssh` directory is writable
- Verify ssh-keygen is available: `which ssh-keygen`
- Check file permissions on `.ssh` directory (should be 700)

### File Download Issues

If files fail to download:
- Check internet connectivity from server
- Verify GitHub URLs are accessible
- Check file permissions on `public_html` directory

## Files

- `installer.php` - Main installer script (only file you need to upload)
- `deploy.php` - Deployment script (downloaded automatically by installer)
- `deploy-config.php` - Configuration file (generated by installer)

## License

This installer is provided as-is for use with [simple-php-git-deploy](https://github.com/markomarkovic/simple-php-git-deploy).
